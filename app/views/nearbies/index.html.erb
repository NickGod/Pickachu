<!-- <p id="notice"><%= notice %></p>
 -->
<h1 class="nearby-title">Nearby goods</h1>



<!--   <div id="map_canvas"></div>
  <%= javascript_include_tag 'https://maps.googleapis.com/maps/api/js?key=AIzaSyBqGHXqWZ2hO2atUBSMRZluvbz0UHCMCv4' %>
  <%= javascript_include_tag 'google_map' %>
  <%= javascript_tag do %>
  google.maps.event.addDomListener(window, 'load', initialize);
  <% end %>
     -->

 <div id="multi_markers" class="nearby-map"></div>

<br>

<script> 

//get geolocation first
function displayOnMap(position){
  var marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude,
    infowindow: 'You are here!'
  });
  handler.map.centerOn(marker);

  google.maps.event.trigger(marker.getServiceObject(), 'click');
  // console.log(marker);
  // marker.infowindow.open(handler.getMap(), marker);
};


var mapStyle = [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#2c3e50"},{"visibility":"on"}]}];

var handler = Gmaps.build('Google');
handler.buildMap({ 
  internal: {id: 'multi_markers'},
  provider: {
      styles: mapStyle
  }
}, function(){
  var markers = handler.addMarkers(<%=raw @hash.to_json%>);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();

  //display user location
  if(navigator.geolocation)
        navigator.geolocation.getCurrentPosition(displayOnMap);
});

 // var marker = null;
 // google.maps.event.addListener(
 //  handler.getMap(), 'click', function(object){ 
 //    marker = new google.maps.Marker({position: object.latLng, map: handler.getMap()});
 //    handler.addMarkers(marker);
 //    }
 //  );

// function gmaps4rails_callback() {
//    var marker = null;
//    google.maps.event.addListener(
//     Gmaps.map, 'click', function(object){ 
//       alert('Clicked');
//       marker = new google.maps.Marker({position: object.latLng, map: Gmaps4Rails.map})
//       handler.addMarkers(marker);
//       }
//     );
// }


    
</script>

<!-- <%= link_to 'New Nearby', new_nearby_path %>
 -->